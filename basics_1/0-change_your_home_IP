#!/usr/bin/env bash
# Force:
# - localhost  -> 127.0.0.2
# - facebook.com -> 8.8.8.8
# Idempotent & silencieux

set -e

tmp="$(mktemp)"

{
  echo "127.0.0.2 localhost"
  echo "8.8.8.8 facebook.com"
  # Conserver le reste, en retirant uniquement l'ancienne ligne localhost et facebook.com
  awk '!/^[[:space:]]*127\.0\.0\.1[[:space:]]+localhost([[:space:]]|$)/ && !/[[:space:]]facebook\.com([[:space:]]|$)/' /etc/hosts
} > "$tmp"

# Remplacer /etc/hosts
cp "$tmp" /etc/hosts
rm -f "$tmp"
